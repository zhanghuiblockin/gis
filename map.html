<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>产业地图-阜平县农业一张图GIS平台</title>
  <link rel="stylesheet" href="assets/css/bootstrap.min.css">
  <link rel="stylesheet/less" type="text/css" href="assets/css/style.less" />
  <script src="assets/js/less.min.js"></script>
  <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <!-- 高德地图 -->
  <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css" />
  <script src="http://webapi.amap.com/maps?v=1.4.6&key=6f6c7b36575ec0255247ca607f8bf797&plugin=Map3D,AMap.DistrictSearch"></script>
  <!-- <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.4.6&key=6f6c7b36575ec0255247ca607f8bf797&plugin=Map3D,AMap.DistrictSearch"></script> -->
  <style>
    #container {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="side">
      <a href="main.html" class="logo">
        <img src="assets/img/logo.png" alt="">
      </a>
      <div class="list-group ex1">
        <a href="main.html" class="list-group-item">首页</a>
        <a href="map.html" class="list-group-item active">产业地图</a>
        <a href="monitor.html" class="list-group-item">物联监控</a>
        <a href="extension.html" class="list-group-item">农技推广</a>
        <a href="alleviation.html" class="list-group-item">产业扶贫</a>
        <a href="care.html" class="list-group-item">总书记关怀</a>
      </div>
    </div>
    <div class="main">
      <div class="main-content">
        <div class="header">
          <h2>阜平县农业一张图GIS平台</h2>
          <div class="status">
            <span class="user">当前用户 admin</span>
            <a href="modify.html">修改密码</a>
            <a href="#" class="logout">退出</a>
          </div>
          <div class="weather">2018年1月25日&nbsp;&nbsp;&nbsp;&nbsp;晴&nbsp;&nbsp;&nbsp;&nbsp;-3~5℃</div>
        </div>
        <div class="content">
          <div class="container-fluid" style="padding-top:15px; padding-bottom: 15px;">
            <div class="row">
              <div class="col-md-12">
                <div class="box map">
                  <div class="bar box ex1">
                    <h3>筛选</h3>
                    <div class="select" id="area">
                      <b>选择地区</b>
                      <ul></ul>
                      <ul></ul>
                    </div>
                    <div class="select" id="product">
                      <b>产品分类</b>
                      <ul></ul>
                      <ul></ul>
                    </div>
                    <div class="select" id="organization">
                      <b>组织类型</b>
                      <ul></ul>
                      <ul></ul>
                    </div>
                    <div class="search">
                      <div class="input-group">
                        <input type="text" placeholder="请输入地名/农场/合作社/作物等" class="form-control" id="inputSearch">
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-default">
                            <i class="glyphicon glyphicon-search"></i> 快速搜索</button>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="list box ex1" style="display: none">
                    <ul class="list-content">
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                      <li class="cl">
                        <img class="img" src="https://placem.at/people?w=400&h=400&random=1" alt="">
                        <div class="txt">
                          <h4>兴农养殖场
                            <span>【禽类】</span>
                          </h4>
                          <p>负责人：赵国秋
                            <br>地址：阜平县平阳镇平阳村
                            <br>联系方式：13582267277</p>
                        </div>
                      </li>
                    </ul>
                    <div class="pages">
                      <ul class="pagination">
                        <li>
                          <a href="#">&laquo;</a>
                        </li>
                        <li class="active">
                          <a href="#">1</a>
                        </li>
                        <li>
                          <a href="#">2</a>
                        </li>
                        <li>
                          <a href="#">3</a>
                        </li>
                        <li>
                          <a href="#">4</a>
                        </li>
                        <li>
                          <a href="#">5</a>
                        </li>
                        <li>
                          <a href="#">&raquo;</a>
                        </li>
                        <li>
                          <span>共5页</span>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="box ex1 detail">
                    <span class="close">&times;</span>
                    <div class="l">
                      <div>
                        <img src="https://placem.at/people?w=300&h=200&random=1" alt="">
                      </div>
                      <video controls src="https://image.wanda.cn/uploadfile/2016/0504/20160504044136946.mp4"></video>
                    </div>
                    <div class="r">
                      <h3>名称：兴农养殖场 【禽类】 面积：25亩</h3>
                      <p class="info">地址：阜平县平阳镇平阳村
                        <br> 负责人：赵国秋
                        <br> 联系方式：13582267277
                        <br> 主要作物：小麦、大枣、黄岑
                      </p>
                      <p class="des">简介：营业范围：组织采购、供应成员所须的饲料；组织收购、销售成员饲养的元鱼；开展与元鱼养殖、经营有关的技术培训、技术 信息服务。（依法须经批准的项目，经相关部门批准后方可开展经营活动）
                      </p>
                    </div>
                  </div>
                  <div id="container"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
  <script src="assets/js/bootstrap.min.js"></script>
  <script src="https://cdn.bootcss.com/lodash.js/4.17.10/lodash.min.js"></script>
  <script src="assets/js/common.js"></script>
  <script type="text/javascript">
    function getMap() {
      var $argumentsLen = arguments.length;
      var $arguments = arguments;
      $.ajax({
        type: "get",
        url: "../assets/mock/info.json",
        dataType: "json",
        success: function (res) {

          // 地图初始化
          var map = new AMap.Map('container', {
            resizeEnable: true,
            viewMode: '3D',
            pitch: 50,
            zoom: 10,
            center: [114.195083, 38.849236]
          });

          // 获取大类、小类企业信息
          // id:大类ID(必填),subId:子类id(选填)
          // 具体请看info.json相关模拟字段
          // 调用方法 getCompany(1,101)/getCompany(1);
          function getCompany(id, subId) {
            // 详情列表
            if (id && subId) {
              for (var i = 0; i < res.length; i++) {
                if (res[i].id == id && res[i].subId == subId) {
                  return res[i].child
                }
              }
            }
            // 大类列表
            if (id && !subId) {
              var arr = [];
              for (var i = 0; i < res.length; i++) {
                if (res[i].id == id && res[i].child.length > 0) {
                  for (var j = 0; j < res[i].child.length; j++) {
                    arr.push(res[i].child[j])
                  }
                }
              }
              return arr;
            }
          }

          function markerClick(e) {
            infoWindow.setContent(e.target.content);
            infoWindow.open(map, e.target.getPosition());
          }
          var company = []
          if ($argumentsLen == 0) {
            companys = getCompany(1);
          }
          if ($argumentsLen == 1) {
            companys = getCompany($arguments[0]);
          }
          if ($argumentsLen == 2) {
            companys = getCompany($arguments[0], $arguments[1]);
          }
          console.log($argumentsLen);

          var infoWindow = new AMap.InfoWindow({ offset: new AMap.Pixel(0, -30) });
          for (var i = 0, marker; i < companys.length; i++) {
            var marker = new AMap.Marker({
              position: companys[i].lnglats,
              map: map
            });
            var infoStr = '<div class="box ex1"><div class="info-content cl"><img class="img" src="' + companys[i].img + '" alt=""><div class="txt"><h4>' + companys[i].name + '<span>【XXX】</span></h4><p>联系人：' + companys[i].contact + '<br>地址：' + companys[i].add + '<br>联系方式：' + companys[i].tel + '</p><a onclick="openDetail('+ companys.idx +')">查看详情</a></div></div></div>'
            marker.content = infoStr;
            marker.on('click', markerClick);
          }
          map.setFitView();
        }
      });
    }
    getMap()
  </script>
  <script>
    $(function () {
      $.ajax({
        type: "get",
        url: "../assets/mock/select.json",
        dataType: "json",
        success: function (res) {
          var catId, subId;
          var area = res.area;
          var areaLen = res.area.length;
          var product = res.product;
          var productLen = res.product.length;
          var organization = res.organization;
          var organizationLen = res.organization.length;

          $('#inputSearch').click(function (e) {
            e.stopPropagation();
            $('.list.box.ex1').show();
            return false;
          });

          var selectTxt = [];
          $(".select").click(function (e) {
            $('.select').removeClass('active');
            $(".select ul").hide();
            $(this).addClass('active').find('ul').eq(0).fadeIn();
            return false;
          });

          // 生成下拉一级结构
          var areaUl1Str = '',
            productUl1Str = '',
            organizationUl1Str = '';
          for (var i = 0; i < areaLen; i++) {
            areaUl1Str += '<li data-id="' + area[i].id + '">' + area[i].name + '</li>'
          }
          $('#area ul:eq(0)').html(areaUl1Str);
          for (var i = 0; i < productLen; i++) {
            productUl1Str += '<li data-id="' + product[i].id + '">' + product[i].name + '</li>'
          }
          $('#product ul:eq(0)').html(productUl1Str);
          for (var i = 0; i < organizationLen; i++) {
            organizationUl1Str += '<li data-id="' + organization[i].id + '">' + organization[i].name + '</li>'
          }
          $('#organization ul:eq(0)').html(organizationUl1Str);


          // 一级点击
          $(".select").on('click', 'ul:eq(0) li', function (e) {
            catId = $(this).data('id');
            var tar = $(this).closest('.select').attr('id'); //String:area,product,organization
            $(this).addClass('active').siblings().removeClass('active')

            switch (tar) {
              case 'area':
                var objSelect = _.find(area, function (o) { return o.id == catId })
                var arrChild = objSelect.child.length;
                if (arrChild > 0) {
                  var areaUl2Str = ''
                  for (var i = 0; i < arrChild; i++) {
                    areaUl2Str += '<li data-id="' + objSelect.child[i].id + '">' + objSelect.child[i].name + '</li>'
                  }
                  $(this).parent().next('ul').html(areaUl2Str);
                  $(this).parent().next('ul').fadeIn();
                } else {
                  $('.select ul').fadeOut();
                }
                console.log('area-catId', catId, );

                break;

              case 'product':
                var objSelect = _.find(product, function (o) { return o.id == catId })
                var arrChild = objSelect.child.length;
                // console.log(objSelect);
                if (arrChild > 0) {
                  var productUl2Str = ''
                  // 生成二级结构
                  for (var i = 0; i < arrChild; i++) {
                    productUl2Str += '<li data-id="' + objSelect.child[i].id + '">' + objSelect.child[i].name + '</li>'
                  }
                  $(this).parent().next('ul').html(productUl2Str);
                  $(this).parent().next('ul').fadeIn();
                } else {
                  $('.select ul').fadeOut();
                }
                console.log('product-catId', catId, );  // ??????????????????
                getMap(catId)
                break;

              case 'organization':
                $('.select ul').fadeOut();
                console.log('organization-catId', catId, );
                break;
            }
            selectTxt[0] = $(this).text()
            $(this).closest('.select').find('b').html(selectTxt[0])
            return false;
          })
          $(".select").on('click', 'ul:eq(1) li', function (e) {
            var subId = $(this).data('id');
            $(this).addClass('active').siblings().removeClass('active')
            $('.select ul').fadeOut();
            selectTxt[1] = $(this).text()
            $(this).closest('.select').find('b').html(selectTxt[0] + '/' + selectTxt[1])
            $('.select').removeClass('active');
            console.log(subId);
            getMap(catId, subId)
            return false;
          })
        }
      });

      $(document).on('click', function (e) {
        $('.select').removeClass('active');
        $('.select ul').fadeOut();
        var contentEle = $('.list.box.ex1');
        if (contentEle !== e.target && contentEle.has(e.target).length === 0) {
          $('.list.box.ex1').hide()
        }
      })
      $(".box.ex1.detail .close").click(function (e) {
        e.preventDefault();
        $(this).parent().fadeOut();
      });

    });
    function openDetail(info) {
      console.log(info);
    }
  </script>
</body>

</html>